{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Parameters": {
    "shouldRoll": {
      "Type": "String",
      "Default": "false",
      "Description": "Should roll when updating"
    },
    "shouldUpdateTargetCapacity": {
      "Type": "String",
      "Default": "true",
      "AllowedValues": [
        "false",
        "true"
      ],
      "Description": "Should update target capacity on group update"
    },
    "shouldResumeStateful": {
      "Type": "String",
      "Default": "false",
      "AllowedValues": [
        "false",
        "true"
      ],
      "Description": "Should resume stateful instances on group update"
    },
    "shouldDeleteImages": {
      "Type": "String",
      "Default": "false",
      "AllowedValues": [
        "false",
        "true"
      ],
      "Description": "Should delete images for stateful instances on group delete"
    },
    "shouldDeleteNetworkInterfaces": {
      "Type": "String",
      "Default": "false",
      "AllowedValues": [
        "false",
        "true"
      ],
      "Description": "Should delete network interfaces for stateful instances on group delete"
    },
    "shouldDeleteVolumes": {
      "Type": "String",
      "Default": "false",
      "AllowedValues": [
        "false",
        "true"
      ],
      "Description": "Should delete volumes for stateful instances on group delete"
    },
    "shouldDeleteSnapshots": {
      "Type": "String",
      "Default": "false",
      "AllowedValues": [
        "false",
        "true"
      ],
      "Description": "Should delete snapshots for stateful instances on group delete"
    }
  },
  "Resources": {
    "SpotinstElastigroup": {
      "Type": "Custom::elasticgroup",
      "Properties": {
        "ServiceToken": "arn:aws:lambda:us-west-2:178579023202:function:spotinst-cloudformation",
        "accessToken": "",
        "accountId": "",
        "updatePolicy": {
          "shouldRoll": {
            "Ref": "shouldRoll"
          },
          "shouldResumeStateful": {
            "Ref": "shouldResumeStateful"
          },
          "rollConfig": {
            "batchSizePercentage": 50,
            "gracePeriod": 600
          },
          "shouldUpdateTargetCapacity": {
            "Ref": "shouldUpdateTargetCapacity"
          }
        },
        "group": {
          "region": "",
          "name": "redis-slaves-elastigroup",
          "description": "created by CloudFormation",
          "strategy": {
            "risk": 100,
            "availabilityVsCost": "balanced",
            "drainingTimeout": 120,
            "fallbackToOd": true,
            "persistence": {
              "shouldPersistBlockDevices": false,
              "shouldPersistRootDevice": true,
              "shouldPersistPrivateIp": true
            }
          },
          "capacity": {
            "target": 3,
            "minimum": 3,
            "maximum": 3,
            "unit": "instance"
          },
          "scaling": {},
          "compute": {
            "instanceTypes": {
              "ondemand": "r4.large",
              "spot": [
                "r4.xlarge",
                "r4.2xlarge"
              ],
              "preferredSpot": [
                "r4.xlarge"
              ]
            },
            "availabilityZones": [
              {
                "name": "",
                "subnetIds": [
                  ""
                ]
              }
            ],
            "product": "Linux/UNIX",
            "launchSpecification": {
              "loadBalancersConfig": {
                "loadBalancers": [
                  {
                    "name": "",
                    "arn": "",
                    "type": "TARGET_GROUP"
                  }
                ]
              },
              "securityGroupIds": [
                "sg-0d30e87e92449051b"
              ],
              "monitoring": false,
              "ebsOptimized": true,
              "imageId": "",
              "keyPair": "",
              "userData": "ICAgICAgICAgICAgICAgICAgICAgICAgICAgICMhYmluL2Jhc2gKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWRvIHl1bSAteSB1cGRhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1ZG8geXVtIC15IGluc3RhbGwgZ2NjIGdjYy1jKysgbWFrZSBqZW1hbGxvYyB0Y2wKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VkbyBta2RpciAvZXRjL3JlZGlzIC92YXIvbGliL3JlZGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNkIC91c3IvbG9jYWwvc3JjCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWRvIHdnZXQgImh0dHA6Ly9kb3dubG9hZC5yZWRpcy5pby9yZWRpcy1zdGFibGUudGFyLmd6IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VkbyB0YXIgdnh6ZiAicmVkaXMtc3RhYmxlLnRhci5neiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1ZG8gcm0gLWYgInJlZGlzLXN0YWJsZS50YXIuZ3oiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZCAicmVkaXMtc3RhYmxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VkbyBtYWtlIGRpc3RjbGVhbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VkbyBtYWtlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWRvIG1ha2UgaW5zdGFsbAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1ZG8gc2VkIC1lICJzL15iaW5kIDEyNy4wLjAuMSQvYmluZCAkKGhvc3RuYW1lIC1JIHwgeGFyZ3MpLyIgLWUgInMvXiMgY2x1c3Rlci1lbmFibGVkIHllcyQvY2x1c3Rlci1lbmFibGVkIHllcy8iIC1lICJzL14jIGNsdXN0ZXItY29uZmlnLWZpbGUgbm9kZXMtNjM3OS5jb25mJC9jbHVzdGVyLWNvbmZpZy1maWxlIG5vZGVzLTYzNzkuY29uZi8iIC1lICJzL14jIGNsdXN0ZXItbm9kZS10aW1lb3V0IDE1MDAwJC9jbHVzdGVyLW5vZGUtdGltZW91dCAxNTAwMC8iICAtZSAicy9eZGFlbW9uaXplIG5vJC9kYWVtb25pemUgeWVzLyIgLWUgInMvXmRpciBcLlwvL2RpciBcL3ZhclwvbGliXC9yZWRpc1wvLyIgLWUgInMvXmxvZ2xldmVsIHZlcmJvc2UkL2xvZ2xldmVsIG5vdGljZS8iIC1lICJzL15sb2dmaWxlIFwiXCIkL2xvZ2ZpbGUgXC92YXJcL2xvZ1wvcmVkaXMubG9nLyIgcmVkaXMuY29uZiB8IHN1ZG8gdGVlIC4vcmVkaXNOZXcuY29uZgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlzLXNlcnZlciAuL3JlZGlzTmV3LmNvbmYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlzLWNsaSAtLWNsdXN0ZXIgYWRkLW5vZGUgJChob3N0bmFtZSAtSSB8IHhhcmdzKTo2Mzc5IDEwLjAuMi4yNDo2Mzc5IC0tY2x1c3Rlci1zbGF2ZQo=",
              "tags": [
                {
                  "tagKey": "Creator",
                  "tagValue": "Spotinst"
                },
                {
                  "tagKey": "Name",
                  "tagValue": "Redis"
                }
              ],
              "creditSpecification": {
                "cpuCredits": "unlimited"
              },
              "tenancy": "default"
            },
            "subnetIds": [
              ""
            ]
          },
          "scheduling": {},
          "thirdPartiesIntegration": {}
        }
      }
    }
  }
}
